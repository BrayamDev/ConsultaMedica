@model ConsultaMedica.Models.Factura

@{
    ViewData["Title"] = "Factura Generada";
    Layout = "_Layout"; // Ajusta según tu layout
}

<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-success text-white">
            <h2 class="mb-0">Factura Generada con Éxito</h2>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h4>Datos de la Factura</h4>
                    <hr />
                    <dl class="row">
                        <dt class="col-sm-4">Número:</dt>
                        <dd class="col-sm-8">@Model.NumeroFactura</dd>

                        <dt class="col-sm-4">Fecha:</dt>
                        <dd class="col-sm-8">@Model.FechaFactura.ToString("dd/MM/yyyy")</dd>

                        <dt class="col-sm-4">Paciente:</dt>
                        <dd class="col-sm-8">@Model.Paciente?.NombreCompleto</dd> <!-- Ajusta según tu propiedad -->

                        <dt class="col-sm-4">Empresa:</dt>
                        <dd class="col-sm-8">@Model.Empresa</dd>

                        <dt class="col-sm-4">Forma de Pago:</dt>
                        <dd class="col-sm-8">@Model.TipoCobro</dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <h4>Resumen</h4>
                    <hr />
                    <dl class="row">
                        <dt class="col-sm-6">Total Factura:</dt>
                        <dd class="col-sm-6 text-end fw-bold">@Model.ImporteTotal.ToString("C")</dd>

                        @if (!string.IsNullOrEmpty(Model.ObservacionesCobro))
                        {
                            <dt class="col-sm-6">Observaciones:</dt>
                            <dd class="col-sm-6">@Model.ObservacionesCobro</dd>
                        }
                    </dl>
                </div>
            </div>

            <h4>Tratamientos Facturados</h4>
            <hr />
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Tratamiento</th>
                        <th class="text-end">Unidades</th>
                        <th class="text-end">Precio Unitario</th>
                        <th class="text-end">Total</th>
                        @if (Model.TratamientosFacturados?.Any(t => !string.IsNullOrEmpty(t.ObservacionesTratamiento)) == true)
                        {
                            <th>Observaciones</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var tratamiento in Model.TratamientosFacturados ?? new List<TratamientoFacturado>())
                    {
                        <tr>
                            <td>@tratamiento.NombreTratamiento</td>
                            <td class="text-end">@tratamiento.Unidades</td>
                            <td class="text-end">@tratamiento.ImporteUnitario.ToString("C")</td>
                            <td class="text-end">@tratamiento.Total.ToString("C")</td>
                            @if (!string.IsNullOrEmpty(tratamiento.ObservacionesTratamiento))
                            {
                                <td>@tratamiento.ObservacionesTratamiento</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>

            <div class="d-flex justify-content-between mt-4">
                <a href="@Url.Action("Index", "Home")" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Volver al Inicio
                </a>
                <div>
                    <button onclick="window.print()" class="btn btn-primary me-2">
                        <i class="fas fa-print"></i> Imprimir Factura
                    </button>
                    <a href="@Url.Action("DescargarFactura", new { id = Model.Id })" class="btn btn-success">
                        <i class="fas fa-download"></i> Descargar PDF
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        @@media print {
            body * {
                visibility: hidden;
            }

            .card, .card * {
                visibility: visible;
            }

            .card {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
            }

            .no-print {
                display: none !important;
            }
        }
    </style>
}